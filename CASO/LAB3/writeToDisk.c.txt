#include <stdlib.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/time.h>

//size in bytes:
#define WRITESIZE  500*1024*1024

const char * USAGE = "./writeToDisk pathToWrite";

struct timeval tv0, tv1;
double secs;

int main(int argc, char * argv[]){
        if(argc != 2) {
                printf(USAGE);
                return -1;
        }
        printf("going to write to : %s\n", argv[1]);
        int fd;
        fd = open(argv[1], O_CREAT|O_RDWR, S_IRWXU);

        long long written = 0;
        int a[1024];
        for(int i=0;i< 1024;++i) a[i]=6;
        int res;
        res = gettimeofday(&tv0, NULL);
        printf("size of each write %d.\n", sizeof(a));
        if(res < 0) perror("gettimeoftoday");
        int w;
        while(written < WRITESIZE){
                w = write(fd, a, sizeof(a));
//              printf("Writtin %d bytes\n", w);
                if(w != sizeof(a)) perror("error in a write.\n");
                written += w;
        }
        res = gettimeofday(&tv1, NULL);
        if(res < 0) perror("gettimeoftoday");
        secs = (((double)tv1.tv_sec*1000000.0 + (double)tv1.tv_usec) - ((double)  tv0.tv_sec*1000000.0 + (double)tv0.tv_usec))/1000000.0;
        printf("temps en segons: %lf.\n", secs);
        double bw = written/secs;
        printf("BW: %lf.\n", bw);
        return 0;
}
